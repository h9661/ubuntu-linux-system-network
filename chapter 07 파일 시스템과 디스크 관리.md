# 01. 리눅스 파일 시스템의 종류

## 1.1 리눅스 고유의 디스크 기반 파일 시스템

파일과 디렉터리를 관리하려면 파일 시스템이 필요하다. 리눅스는 초기 `MFS`를 사용했으나, 지금은 `ext`를 사용한다.

### ext(ext1)

### ext2

### ext3

### ext4

### XFS

## 1.2 리눅스에서 지원하는 기타 디스크 기반 파일 시스템

리눅스는 표준 파일 시스템 이외에도 윈도우 시스템이나 외부 저장 장치를 사용할 수 있도록 다양한 파일 시스템을 지원한다.

## 1.3 특수 용도의 가상 파일 시스템

리눅스에서는 디스크가 아니라 메모리에서 생성되어 사용되는 가상 파일 시스템이 있다. 가상 파일 시스템은 특수한 용도로 필요에 따라 생겼다 없어진다. 리눅스의 주요 가상 파일 시스템은 다음과 같다.

| 가상 파일 시스템 | 설명                                                                                           |
| ---------------- | ---------------------------------------------------------------------------------------------- |
| /proc            | 프로세스와 관련된 정보를 제공하는 파일 시스템. 커널의 현재 상태를 나타내는 파일을 가지고 있다. |
| /swap            | 스왑 파일 시스템                                                                               |
| /tmpfs           | 메모리에 임시 파일을 저장하기 위한 파일 시스템                                                 |
| /ramfs           | 램디스크를 지원하는 파일 시스템                                                                |
| /rootfs          | 루트 파일 시스템으로 `/` 디렉터리이다. 시스템 초기화 및 관리에 필요한 내용을 관리한다.         |

## 1.4 현재 시스템이 지원하는 파일 시스템 확인하기

`/proc/filesystems` 파일을 확인하면 현재 시스템에서 지원하는 파일 시스템을 확인할 수 있다.

```bash
$ cat /proc/filesystems

nodev   sysfs
...
```

# 02. 리눅스 파일 시스템의 구조

리눅스의 모든 파일은 다음 세 가지 개념으로 이루어져 있다.

- 파일은 inode로 관리된다.
- 디렉터리는 단순히 파일의 목록을 가지고 있는 파일이다.
- 특수 파일을 통해 장치에 접근할 수 있다.

여기서는 inode의 구조를 살펴본다.

## 2.1 ext4 파일 시스템 구조

ext4는 디스크를 논리적인 블록의 집합으로 구분한다. 블록 그룹에는 세 가지 유형이 있다.

![](https://mblogthumb-phinf.pstatic.net/MjAxOTAyMjJfMTIx/MDAxNTUwNzY1MzQ0Mzgy.nXJHfgEf1K8tzGgY2K9oz4Orxdi5uSS3r7fnSRy034cg.Xnrj1FdfithoSo_zlLxmUvf9toeSd-GjfQLrwJbCTSsg.PNG.jeffms1/image.png?type=w800)

- 블록 그룹 0
- 블록 그룹 a
- 블록 그룹 b

### 그룹 0 패딩

블록 그룹 0의 첫 1024B는 x86 시스템에서 부트로더가 사용하는 부트 블록이다. 이 부트 블록은 부트로더가 디스크에서 커널을 찾아서 메모리에 로드하는 데 사용된다.

### 슈퍼 블록

슈퍼 블록에는 전체 inode의 갯수, 전체 블록의 갯수 등 파일 시스템과 관련된 다양한 정보가 저장된다. 슈퍼 블록에 문제가 생기면 전체 파일 시스템을 사용할 수 없기에 다른 블록 그룹에 복사해놓고 필요할 때 복사본을 이용하여 복구한다.

### 그룹 디스크립터와 GDT 예약 블록

그룹 디스크립터도 블록 그룹 0에 있는 것으로 슈퍼 블록 다음에 위치한다. 그룹 디스크립터에는 블록 그룹의 크기, inode와 데이터 블록의 시작 위치 등이 저장된다. 이것 또한 복사되어서 필요할 때 복사본을 이용하여 복구한다. GDT 예약 블록은 그룹 디스크립터의 확장을 위한 예비 공간이다.

### 데이터 블록 비트맵과 inode 비트맵

데이터 블록 비트맵은 데이터 블록의 사용 여부를 나타내는 비트맵이다. inode 비트맵은 inode의 사용 여부를 나타내는 비트맵이다.

### inode 테이블과 데이터 블록

리눅스는 inode에 파일 정보를 저장한다. 데이터 블록에는 실제 데이터가 저장된다. 일반 파일은 데이터 블록에 파일 내용을 저장하고, 디렉터리는 데이터 블록에 해당 디렉터리에 있는 파일이나 서브 디렉터리의 정보를 저장한다.

## 2.2 inode 구조

리눅스는 파일을 inode로 관리한다. inode는 파일의 메타 데이터를 저장하는 구조체이다. inode에는 파일의 크기, 소유자, 그룹, 파일의 권한, 파일의 생성 시간, 수정 시간, 마지막 접근 시간, 데이터 블록의 위치 등이 저장된다.

## 2.3 파일 시스템과 디렉터리 계층 구조

### 한 파일 시스템으로 구성하기

![](https://mblogthumb-phinf.pstatic.net/MjAxNzA2MThfMjU0/MDAxNDk3NzIxNjYxODA2.34VkNDTqEjOLcorU-5esfGIGAbn3OqJlmtkUS0Py3zEg.AQtnJ6o3lUzZtUlguCzvrNK4tEVwJp8oF05gS7iUa_Mg.PNG.julie_eun1014/01.PNG?type=w800)

### 여러 파일 시스템으로 구성하기

![](https://mblogthumb-phinf.pstatic.net/MjAxNzA2MThfMTg2/MDAxNDk3NzIxNjYxNDY3.T4KMRWHLn-q7ZHx1XJVnIE8o6NqcYbUB9WsZJs7r5t8g.QZLyxWqvOCwktmRrEBj79vNYXIxujCgASiwTq2-Svisg.PNG.julie_eun1014/02.PNG?type=w800)

# 03. 파일 시스템 마운트

파일 시스템을 디렉터리 계층 구조의 특정 디렉터리와 연결하는 것을 마운트라고 한다.

## 3.1 마운트 포인트

디렉터리 계층 구조에서 파일 시스템이 연결되는 디렉터리를 마운트 포인트라고 한다.

## 3.2 파일 시스템 마운트 설정 파일

리눅스 시스템을 부팅할 때 파일 시스템을 자동으로 마운트할 수 있다. 실제로 이동식 저장 장치를 제외하고 대부분의 파일 시스템은 부팅할 때 마운트된다. 파일 시스템을 자동으로 마운트하려면 `/etc/fstab` 파일에 마운트 정보를 설정해야 한다.

### `/etc/fstab` 파일의 기능

파일 시스템의 마운트 설정 정보를 저장하고 있다. 리눅스 시스템은 부팅할 때 이 파일을 읽고 설정 내용에 따라 파일 시스템을 자동으로 마운트한다.

### `/etc/fstab` 파일의 구조

6개의 항목으로 구성된다

| 구분 | 설명                              |
| ---- | --------------------------------- |
| 1    | 파일 시스템의 장치 이름 또는 UUID |
| 2    | 마운트 포인트                     |
| 3    | 파일 시스템의 종류                |
| 4    | 마운트 시 옵션                    |
| 5    | 덤프 관련 설정                    |
| 6    | 파일 점검 옵션                    |

## 3.3 마운트 관련 명령

```bash
$ mount [옵션] [장치명 또는 마운트 포인트] [마운트 포인트]

$ unmount [옵션] [장치명 또는 마운트 포인트]
```

### `mount` 명령만 사용하는 경우

옵션이나 인자를 사용하지 않고 `mount` 명령만 사용하면 현재 마운트된 파일 시스템의 목록을 출력한다.

```bash
$ mount

/dev/sda1 on / type ext4 (rw,relatime,errors=remount-ro,data=ordered)
...
```

### `mount` 명령으로 장치를 연결하는 방법

```bash
$ mount [장치명] [마운트 포인트]

$ mount /dev/sdb1 /mnt
```

# 04. 디스크 추가 설치

## 4.1 가상 머신에 디스크 추가하기

## 4.2 디스크 파티션 나누기

## 4.3 파일 시스템 생성하기

## 4.4 디스크 마운트하기

## 4.5 여러 디스크를 하나처럼 사용하기

# 05. 디스크 관리

## 5.1 디스크 사용량 확인하기

## 5.2 파일 시스템 검사하고 복구하기
