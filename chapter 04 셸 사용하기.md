# 00 개요

셸은 리눅스 커널과 사용자를 연결하는 중요한 역할을 수행한다. 사용자가 입력한 내용을 해석하여 관련 명령을 실행하고 그 결과를 출력한다. 따라서, 사용자는 셸을 통해 리눅스를 만난다고 할 수 있다.

이 장에서는 배시 셸을 사용하는 법을 배우고 사용자 환경을 설정하는 방법을 배운다. 셸 프로그래밍은 광범위하여 다루지 않는다.

# 01 셸의 기능과 종류

셸은 다양한 종류가 있다. 그리고 각각에 있어서 약간의 차이가 있다. 여기서는 셸의 핵심 기능과 주요 셸의 특징에 대해 알아본다.

## 1.1 셸의 기능

셸이 제공하는 기능은 크게 명령어 해석, 프로그래밍, 사용자 환경 설정 등이 있다.

### 명령어 해석기 기능

셸의 가장 기본적인 기능은 사용자가 입력한 명령을 해석하고 번역하는 기능이다. 사용자가 로그인하면 실행되며 `/etc/passwd` 파일에 사용자별로 지정된다.

셸은 입력된 명령어가 자체 명령어인지 판단한다. 만약 자체 명령어라면 바로 실행하고, 아니라면 자식 프로세스를 만들어서 실행 파일을 실행하게 한다. 자식 프로세스가 실행되는 동안, 부모 프로세스인 셸은 대기 상태가 되고 자식 프로세스가 종료되면 다시 실행된다.

### 프로그래밍 기능

셸은 여러 명령어를 조합하여 하나의 프로그램처럼 사용할 수 있다. 이를 셸 스크립트라고 한다. 셸 스크립트와 관련된 내용은 이 책에서 다루지 않는다.

### 사용자 환경 설정 기능

셸은 사용자가 로그인할 때마다 초기화 파일 기능을 제공한다. 초기화 파일에는 명령을 찾아오는 경로를 설정하거나 파일과 디렉터리를 새로 생성할 때 권한을 설정하거나 환경 변수를 설정하는 등 사용자의 환경을 설정하는 기능을 제공한다.

## 1.2 셸의 종류

다양한 셸이 있지만, 알 필요는 없으므로 넘어가도록 한다.

# 02 셸 기본 사용법

배시 셸을 중심으로 기본 셸 지정하고 바꾸기, 셸에서 출력하기, 특수문자 사용하기 등 사용법에 대해 알아보자.

## 2.1 셸 지정하고 바꾸기

현재 사용하는 셸의 종류를 보는 가장 쉬운 법은 프로세스 정보를 보는 것이다.

```bash
$ grep chanwoo /etc/passwd

chanwoo:x:1000:1000:chanwoo,,,:/home/chanwoo:/bin/bash
```

위의 결과를 보면, `chanwoo` 사용자의 셸이 `/bin/bash`로 지정되어 있다. 이는 `chanwoo` 사용자가 로그인할 때 `/bin/bash`가 실행되어 셸이 되는 것을 의미한다.

### 기본 셸 바꾸기

`/etc/passwd` 파일을 수정하여 기본 셸을 바꿀 수 있다. 하지만 이 방법은 추천하지 않는다. 대신 `chsh` 명령어를 사용하는 것이 좋다. 사용 가능한 셸은 `/etc/shells` 파일을 확인하면 된다.

```bash
$ chsh -s /bin/bash
```

### 로그인 셸과 서브 셸

사용자는 프롬프트에서 다른 셸을 사용할 수 있는데 이것을 서브 셸이라고 부른다.

## 2.2 셸 내장 명령

셸 내장 명령은 별도의 실행 파일이 없고 셸 안에 포함되어 있다. 대표적인 셸 내장 명령은 `cd`이다.

## 2.3 출력하기

배시 셸의 출력 명령으로는 `echo`와 `printf`가 있다. `echo`는 문자열을 출력하는 명령어이고, `printf`는 `C`언어의 `printf`와 비슷하다.

```bash
$ echo "Hello, world!"
Hello, world!

$ printf "Hello, world! %d + %d = %d\n" 1 2 3
Hello, world!
```

## 2.4 특수 문자 사용하기

셸은 먼저 입력된 내용 중에 특수 문자가 있는지 확인하고 이를 해독하여 적절한 형태로 변형 후 명령어를 실행한다. 특수 문자 사용법에 대해 자세히 알아보자.

### `*`

`*`는 와일드카드 문자로, 임의의 문자열을 의미한다. `*`는 파일 이름을 지정할 때 사용할 수 있다.

```bash
$ ls *.txt

a.txt b.txt c.txt
```

### `?`, `[]`

`?`는 임의의 한 문자를 의미하고, `[]`는 임의의 한 문자를 의미한다. `[]`는 문자열을 지정할 때 사용할 수 있다.

```bash
$ ls a?.txt

a1.txt a2.txt a3.txt
```

```bash

$ ls a[1-3].txt

a1.txt a2.txt a3.txt
```

### `~`, `-`

`~`는 홈 디렉터리를 의미하고, `-`는 이전 디렉터리를 의미한다.

```bash
$ cd ~
$ cd -
```

### `;`, `|`

`;`는 명령어를 연속으로 실행하고, `|`는 앞의 명령어의 결과를 뒤의 명령어의 입력으로 사용한다.

```bash
$ ls; pwd

a.txt b.txt c.txt
/home/chanwoo
```

```bash
$ ls | grep a

a.txt a1.txt a2.txt a3.txt
```

### `'`, `"`

`'`는 문자열을 그대로 해석하고, `"`는 문자열을 해석한 후 출력한다. `"`사이의 `$`는 변수를 의미한다.

```bash
$ echo 'Hello, $USER!'
Hello, $USER!

$ echo "Hello, $USER!"
Hello, chanwoo!
```

### `(백틱)`

`(백틱)`은 명령어를 실행한 후 그 결과를 출력한다.

```bash
$ echo `pwd`

/home/chanwoo
```

### `>`, `<`, `>>`

이 특수문자들은 입출력의 방향을 바꾸는 특수문자로, 다음 절에서 자세히 설명한다.

```bash
$ ls -l > ls.txt

# ls.txt 파일에 ls -l 명령어의 결과가 저장된다.
```

# 03 입출력 방향 바꾸기

리눅스에서 입력과 출력으로 사용하는 장치를 바꾸면 출력을 화면이 아닌 파일에 하고 입력도 파일에서 받을 수 있다.이 절에서는 이처럼 입출력 장치를 바꾸는 방법에 대해서 알아보자.

## 3.1 표준 입출력 장치

2장에서 리눅스는 장치도 파일로 관리한다고 하였다. 셸은 작업 중 필요한 파일에 일련번호를 붙여서 관리하는데, `파일 디스크립터`라고 한다. 표준 입출력 장치도 파일로 관리되기 때문에 파일 디스크립터가 부여되어 있다. 입출력 장치를 변경할 때는 이 파일 디스크립터를 사용한다.

| 파일 디스크립터 | 장치           |
| --------------- | -------------- |
| 0               | 표준 입력 장치 |
| 1               | 표준 출력 장치 |
| 2               | 표준 에러 장치 |

## 3.2 출력 리다이렉션

출력의 방향을 바꾸는 출력 리다이렉션은 두 가지 방법이 있다. 두 방법의 차이는 출력을 추가할 것인지 덮어쓸 것인지의 차이이다. 덮어쓰기는 `>`를 사용하고, 추가는 `>>`를 사용한다.

### 파일 덮어쓰기

```bash
$ ls -l > ls.txt

$ ls -l 1> ls.txt
```

두 번째 형식의 1은 파일 디스크립터 1번을 의미한다. 즉 지정한 파일을 1번 파일로 간주하겠다는 것이다. 파일 디스크립터 1은 생략 가능하다.

### 파일에 내용 추가하기

```bash
$ ls -l >> ls.txt

$ ls -l 1>> ls.txt
```

## 3.3 오류 리다이렉션

오류 리다이렉션은 출력 리다이렉션과 동일하다. 오류 리다이렉션은 `2>`와 `2>>`를 사용한다.

```bash
$ ls -l 2> ls.txt

$ ls -l 2>> ls.txt
```

### 표준 출력과 표준 에러를 동시에 리다이렉션하기

```bash
$ ls . /abc 1> ls.out 2> ls.err
```

### 오류 메시지 버리기

```bash
$ ls . /abc 2> /dev/null
```

### 표준 출력과 표준 오류를 한 파일로 리다이렉션하기

```bash
$ ls . /abc 1> ls.out 2>&1
```

## 3.4 입력 리다이렉션

`<`는 표준 입력 장치 파일을 리다이렉션하는 기능을 제공하는 특수문자이다.

```bash
$ sort 0< ls.txt
```

# 04 배시 셸 환경 설정

셸은 셸의 환경을 설정하기 위한 값을 저장할 수 있도록 셸 변수와 환경 변수를 제공한다. 이 변수를 이용해서 각각 원하는 환경을 설정할 수 있다. 이 변수에는 사용자 정보, 명령을 찾아오는 경로, 각 사용자의 프롬프트 모양 등 다양한 정보가 저장된다.

## 4.1 셸이 제공하는 변수 및 출력하기

셸이 사용하는 변수에는 셸 변수와 환경 변수가 있다. 셸 변수는 현재 셸에서만 사용 가능하고, 서브 셸로는 전달되지 않지만 환경 변수는 현재 셸과 서브 셸 모두에서 사용 가능하다.

### 전체 변수 출력하기 : `set`, `env`

`set` 명령어는 셸 변수와 환경 변수를 모두 출력한다. 또한 함수로 정의된 것들도 출력한다. `env` 명령어는 환경 변수만 출력한다.

```bash
$ set

BASH=/bin/bash
BASHOPTS=checkwinsize:cmdhist:complete_fullquote:expand_aliases:extglob:extquote:force_fignore:histappend:interactive_comments:progcomp:promptvars:sourcepath
...

$ env

BASH=/bin/bash
```

### 특정 변수 출력하기 : `echo`

`echo` 명령어를 사용하면 특정 변수의 값을 출력할 수 있다.

```bash
$ echo $HOME

/home/chanwoo
```

## 4.2 셸 변수와 환경 변수 설정하기

셸 변수를 설정하는 방법은 다음과 같다. 이때 변수명과 문자열 사이에 공백이 있으면 안된다.

```bash
$ 변수명=문자열
```

### 환경 변수 설정하기 : `export`

셸 변수는 현재 셸에서만 사용할 수 있고 서브 셸로는 전달되지 않는다. 따라서, 환경 변수로 설정해야 한다. 환경 변수로 설정하려면 `export` 명령어를 사용하면 된다.

```bash
$ export 변수명=문자열

$ export -n 변수명 # 환경 변수 -> 셸 변수
```

## 4.3 변수 해제하기

변수를 해제하는 방법은 다음과 같다.

```bash
$ unset 변수명
```

# 05 에일리어스와 히스토리

셸은 에일리어스와 히스토리라는 편리한 기능을 제공한다. 에일리어스는 복잡한 명령을 짧은 별명으로 사용할 수 있게 해주고, 히스토리는 앞에서 입력했던 명령을 다시 불러서 사용하는 것을 말한다.

## 5.1 에일리어스

에일리어스는 복잡한 명령을 짧은 별명으로 사용할 수 있게 해주는 기능이다. 에일리어스는 `alias` 명령어를 사용하여 설정할 수 있다.

```bash
$ alias 별명='명령어'
$ alias # 설정된 에일리어스 출력
$ alias 별명='명령어1; 명령어2; 명령어3; ...' # 여러 명령어를 한 줄에 설정
```

### 에일리어스 설정하기

```bash
$ alias ls='ls -F'
$ ls # ls 명령어를 입력하면 ls -F 명령어가 실행된다.

a.txt b.txt c.txt
```

### 에일리어스 해제하기

```bash
$ unalias ls
```

## 5.2 히스토리

긴 명령에 오타가 나면 그 긴 명령을 다시 입력해야 해서 불편하다. 이럴 때 사용하는 것이 히스토리이다. 이전에 입력한 명령을 다시 불러서 사용할 수 있다.

### 이전 명령 보기 : `history`

`history` 명령어를 사용하면 이전에 입력한 명령을 확인할 수 있다.

```bash
$ history

1 ls
...
```

### 이전 명령 재실행하기 : `!`

`!`를 사용하면 이전에 입력한 명령을 다시 실행할 수 있다.

```bash
$ !번호 # 번호 명령어를 다시 실행한다.
$ !! # 이전 명령어를 다시 실행한다.
$ !문자열 # 문자열로 시작하는 이전 명령어를 다시 실행한다.
```

### 히스토리 저장하기

터미널에서 작업을 마치고 로그아웃할 때 배시 셸은 히스토리를 `~/.bash_history`에 저장한다.

# 06 프롬프트 설정

## 6.1 이스케이프 문자와 프롬프트 설정하기

## 컬러 프롬프트 설정하기

# 07 환경 설정 파일

지금까지 설정한 에얼리어스나 프롬프트 모양은 로그아웃하면 모두 사라진다. 이를 방지하기 위해 환경 설정 파일을 사용한다. 환경 설정 파일은 로그아웃해도 사라지지 않고, 다시 로그인하면 설정한 내용이 그대로 적용된다.

## 7.1 시스템 환경 설정 파일

시스템 환경 설정 파일은 모든 사용자에게 공통으로 적용되는 설정 파일이다. 다음 세 가지가 있다.

- `/etc/profile`

1. 모든 셸에서 공통으로 적용되는 `.profile` 파일이다.
2. 배시 셸인 경우 `/etc/profile` 파일을 실행한 후 `~/.bash_profile` 파일을 실행한다.
3. 배시 셸이 아닌 경우 프롬프트를 #나 $로 설정한다.
4. `/etc/profile.d` 디렉터리에 있는 파일을 실행한다.

- `/etc/bash.bashrc`

1. 시스템 공통으로 적용되는 `.bashrc` 파일이다.
2. 기본 프롬프트를 설정한다.
3. `sudo` 명령과 관련된 힌트를 제공한다.

- `/etc/profile.d/*.sh`

1. 언어나 명령별로 각각 필요한 환경을 설정한다.
2. 필요시 설정 파일을 추가한다.

이 중 `/etc/profile`과 `/etc/bash.bashrc` 파일은 수정하지 않는 것이 좋다. 시스템별로 환경을 다르게 구성할 필요가 있으면 `/etc/profile.d` 디렉터리에 새로운 파일을 만들어서 설정하면 된다. 참고로 `/etc/profile` 앞부분을 출력해보면 다음과 같다.

```bash
# /etc/profile: system-wide .profile file for the Bourne shell (sh(1))
# and Bourne compatible shells (bash(1), ksh(1), ash(1), ...).

if [ "$PS1" ]; then
  if [ "$BASH" ] && [ "$BASH" != "/bin/sh" ]; then
    # The file bash.bashrc already sets the default PS1.
    # PS1='\h:\w\$ '
    if [ -f /etc/bash.bashrc ]; then
      . /etc/bash.bashrc
    fi
  else
    if [ "`id -u`" -eq 0 ]; then
      PS1='# '
    else
      PS1='$ '
    fi
  fi
fi
(생략)
```

## 7.2 사용자 환경 설정 파일

사용자 환경 설정 파일은 각 사용자의 홈 디렉터리에 숨김 파일로 있으며 사용자가 내용을 수정하고 관리할 수 있다. 사용자가 로그인하면 제일 먼저 시스템 환경 설정 파일이 실행되어 시스템 공통 환경을 만들고 이후 사용자 환경 설정 파일을 순서대로 실행해서 사용자별 환경을 설정한다.

배시 셸의 사용자 환경 설정 파일은 다음 표와 같다.

- `~/.profile`

1. 경로 추가 등 사용자가 정의하는 환경을 설정한다.
2. `~/.bashrc` 파일을 실행한다.

- `~/.bashrc`

1. 히스토리의 크기를 설정한다.
2. 기본 에얼리어스나 함수 등을 설정한다.

- `~/.bash_aliases`

1. 사용자가 정의한 에얼리어스를 별도 파일로 저장한다.

- `~/.bash_logout`

1. 로그아웃 시 실행팔 필요가 있는 함수 등을 설정한다.

### 사용자 환경 설정 파일 만들기

사용자 환경 설정 파일을 만들려면 다음과 같이 하면 된다.

```bash
$ vi .bash_alias

alias ls='ls -F'
...
:wq
```

### 사용자 환경 설정 파일 적용하기

사용자 환경 설정 파일을 적용하려면 다음과 같이 하면 된다.

```bash
$ source .bash_alias
```
